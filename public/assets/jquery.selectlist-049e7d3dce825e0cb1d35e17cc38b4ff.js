!function(t){t.selectList=function(e,i){function n(t,e){i.addAnimate&&h?"function"==typeof i.addAnimate?i.addAnimate(t.hide().get(0),e):t.hide().fadeIn(300,e):(t.show(),e&&e.call(t.get(0)))}function a(t,e){i.removeAnimate&&h?"function"==typeof i.removeAnimate?i.removeAnimate(t.get(0),e):t.fadeOut(300,e):(t.hide(),e&&e.call(t.get(0)))}function o(e,n){return"function"==typeof i.sort?i.sort(e,n):t(e).data("text")>t(n).data("text")==("desc"!=i.sort)}function s(a,s,u){if(f=null,t(a).is("option")){if(f=t(a),f.get(0).index<x)return;i.duplicates||f.attr("disabled","disabled").data("disabled",!0),a=f.val(),s=f.text()}r=t(i.template.replace(/%text%/g,s).replace(/%value%/g,a)).hide(),t('<input type="hidden" />').appendTo(r).attr({name:t(e).attr("name"),value:a}),r.data("value",a).data("text",s),f&&r.data("option",f),r.addClass(i.classPrefix+"-item"),i.clickRemove&&r.click(function(){d(t(this))}),x&&!v&&(e.selectedIndex=0);var h=function(){u!==!1&&i.onAdd(e,a,s)};if(i.sort&&(c=l.children().eq(0)).length){for(;c.length&&o(r.get(0),c.get(0));)c=c.next();c.length?n(r.insertBefore(c),h):n(r.appendTo(l),h)}else n(r.appendTo(l),h)}function d(n,o){a(n,function(){var n=t(this).data("value"),a=t(this).data("text");t(this).data("option")&&t(this).data("option").removeAttr("disabled").removeData("disabled"),t(this).remove(),o!==!1&&i.onRemove(e,n,a)})}var l,c,r,f,u,h,m,p,v,g,x=0;this.add=function(t,e){s(t,e)},this.remove=function(e){l.children().each(function(){t(this).data("value")==e&&d(t(this))})},this.setOptions=function(e){var n=e.sort&&e.sort!=i.sort;i=t.extend(i,e),n&&l.children().slice(x).each(function(){s(t(this).data("value"),t(this).data("text"),!1)}).remove()},this.setOptions(i=t.extend({addAnimate:!0,classPrefix:"selectlist",clickRemove:!0,removeAnimate:!0,template:"<li>%text%</li>",onAdd:function(){},onRemove:function(){}},i)),(l=t(i.list||t("<ul />").insertAfter(t(e)))).addClass(i.classPrefix+"-list"),t(e).find(":selected").each(function(){s(t(this),null,!1)}),t(e).removeAttr("multiple"),t(e).attr("title")&&(t(e).prepend(t('<option selected="selected" />').text(t(e).attr("title"))),x=1),u=t.browser.msie||t.browser.safari?"keydown":"keypress",t(e).bind(u,function(i){return v=!0,13==(i.keyCode||i.which)?(g=!0,t(e).change(),v=!0,!1):void 0}).change(function(){(v||p)&&(m=!0,f=t(e).find("option:selected"),f.data("disabled")||v&&!g||s(f),v&&(v=m=p=!1),g=!1)}).mousedown(function(){p=!0}),t(e).find("option").click(function(i){return t.browser.mozilla&&i.pageX>=t(e).offset().left&&i.pageX<=t(e).offset().left+t(e).outerWidth()&&i.pageY>=t(e).offset().top&&i.pageY<=t(e).offset().top+t(e).outerHeight()?!1:(p=!0,t(this).attr("disabled")||t(this).data("disabled")||v||m||s(t(this)),v||(m=p=!1),!1)}),t(e.form).submit(function(){t(e).removeAttr("name")}),t(window).bind("beforeunload",function(){t(e).removeAttr("name")}),h=!0},t.fn.selectList=function(e){return e=e||{},this.filter("select").each(function(){t(this).data("selectList")?t(this).data("selectList").setOptions(e):t(this).data("selectList",new t.selectList(this,e))}),e.instance?t(this).filter("select").data("selectList"):this}}(jQuery);